<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로또 추첨기</title>

    <style>
      * {
        box-sizing: border-box;
      }
      #lotto {
        width: 90%;
        min-width: 300px;
        max-width: 600px;
        aspect-ratio: 16/9;
        display: flex;
        flex-direction: column;
        justify-content: center;
        border: 2px rgb(0, 0, 0) solid;
        border-radius: 10px;
        margin-top: 10%;
        justify-self: center;
        margin: 10% auto;
        position: relative;
        padding: 0 min(3%, 2rem);
        background-color: rgb(255, 238, 220);
      }
      #input_form {
        width: 100%;
        height: 20%;
        display: flex;
        justify-content: space-between;
        margin: 5% 0;
      }
      #input_form input {
        width: 80%;
        height: 100%;
        border-radius: 5px;
        text-align: end;
        padding: 5%;
        font-size: clamp(16px, 2.5vw, 24px);
      }
      #input_form input::placeholder {
        text-align: center;
      }
      #input_form button {
        width: 18%;
        font-size: clamp(16px, 2.5vw, 20px);
        cursor: pointer;
      }
      #input_form button:hover {
        transform: translateY(-1px);
      }
      #input_form button:active {
        transform: scale(0.97);
      }
      #input_form button:disabled {
        background-color: rgb(108, 108, 108);
        color: white;
      }
      .numbers_div {
        background-color: rgb(255, 244, 232);
        border: 1px rgb(255, 232, 208) solid;
        border-radius: 5px;
        height: 25%;
        display: flex;
        align-items: center;
        gap: 1%;
        font-size: clamp(16px, 2.5vw, 20px);
      }
      .number {
        border: 1px black solid;
        border-radius: 50%;
        height: 75%;
        aspect-ratio: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: clamp(15px, 2.5vw, 20px);
        background-color: azure;
      }
    </style>
  </head>
  <body>
    <div id="lotto">
      <form id="input_form">
        <input type="text" placeholder="숫자 6개를 입력해주세요." />
        <button>추첨</button>
      </form>
      <div class="numbers_div" id="lottery_div">
        <div id="lottery_numbers">당첨 숫자:</div>
      </div>
      <div class="numbers_div" id="bonus_div">
        <div id="bonus_number">보너스 숫자:</div>
      </div>
    </div>
    <script>
      const $input = document.querySelector("#input_form input");
      const $button = document.querySelector("#input_form button");
      const input_form = document.querySelector("#input_form");
      const lottery_div = document.querySelector("#lottery_div");
      const bonus_div = document.querySelector("#bonus_div");

      let inputNumbers;
      let inputArr;
      let lottoArr;
      let isRunning = false;
      let bonus;

      function handleSubmit() {
        inputNumbers = $input.value;
        if (checkInput(inputNumbers)) {
          isRunning = true;
          $button.disabled = true;

          clearNumbers();
          makeNumbers();
          makeLottoDiv(checkNumbers);
        }
      }

      const checkInput = (str) => {
        if (!/^[\d\s.,-]+$/.test(str)) {
          alert("숫자만 입력하세요");
          return false;
        }

        if (str.includes(".")) {
          alert("소수는 입력할 수 없습니다");
          return false;
        }

        if (str.includes("-")) {
          alert("음수는 입력할 수 없습니다");
          return false;
        }

        const arr = str.match(/\d+/g)?.map(Number);

        if (!arr || arr.length !== 6) {
          alert("숫자 6개를 입력해주세요");
          return false;
        }

        if (new Set(arr).size !== 6) {
          alert("중복되지 않은 숫자를 입력해주세요");
          return false;
        }

        if (!arr.every((v) => Number.isInteger(v) && v >= 1 && v <= 45)) {
          alert("1~45 사이의 정수를 입력해주세요.");
          return false;
        }

        inputArr = arr;
        return true;
      };

      const setTimeoutPromise = (ms) =>
        new Promise((resolve, reject) => {
          setTimeout(resolve, ms);
        });

      const makeNumbers = () => {
        let set = new Set();
        while (set.size < 7) {
          set.add(Math.floor(Math.random() * 45) + 1);
        }
        lottoArr = [...set];
        bonus = lottoArr.at(-1);
        lottoArr = lottoArr.slice(0, 6);
      };

      const makeLottoDiv = async (func) => {
        for (let v of lottoArr) {
          await setTimeoutPromise(1000);
          const div = document.createElement("div");
          div.className = "number";
          div.textContent = v;
          lottery_div.appendChild(div);
        }

        await setTimeoutPromise(1000);
        const div = document.createElement("div");
        div.className = "number";
        div.textContent = bonus;
        bonus_div.appendChild(div);

        await setTimeoutPromise(1000);
        func();
        isRunning = false;
        $button.disabled = false;
        console.log("내 번호는 ", inputArr);
        console.log("로또번호는 ", lottoArr);
        console.log("보너스번호는 ", bonus);
      };

      const checkNumbers = () => {
        let lottoCount = 0;
        let bonusCount = 0;

        inputArr.forEach((v) => {
          if (lottoArr.includes(v)) lottoCount++;
        });
        if (inputArr.includes(bonus)) bonusCount++;

        if (lottoCount == 6) {
          alert("1등 당첨입니다. 축하드립니다!");
        } else if (lottoCount == 5 && bonusCount == 1) {
          alert("2등 당첨입니다. 축하드립니다!)");
        } else if (lottoCount == 5) {
          alert("3등 당첨입니다. 축하드립니다!)");
        } else if (lottoCount == 4) {
          alert("4등 당첨입니다. 축하드립니다!)");
        } else if (lottoCount == 3) {
          alert("5등 당첨입니다. 축하드립니다!)");
        } else {
          alert("아쉽게도 낙첨되셨습니다.");
        }
        console.log(`당첨 : ${lottoCount}\n보너스 : ${bonusCount}`);
      };

      const clearNumbers = () => {
        lottery_div.innerHTML = '<div id="lottery_numbers">당첨 숫자:</div>';
        bonus_div.innerHTML = '<div id="bonus_number">보너스 숫자:</div>';
      };

      input_form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!isRunning) handleSubmit();
      });

      $input.focus();
    </script>
  </body>
</html>
