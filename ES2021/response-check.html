<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>반응속도 테스트</title>

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #screen {
        width: 100%;
        max-width: 600px;
        min-height: 80vh;
        min-height: 80lvh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: x-large;
        font-weight: 700;
        user-select: none;
      }
      #result {
        display: flex;
        justify-content: center;
        padding-top: 20px;
        font-size: large;
      }
      .waiting {
        background-color: blue;
      }
      .starting {
        background-color: red;
      }
      .checking {
        background-color: green;
      }
      .tooFast {
        background-color: blueviolet;
      }
    </style>
  </head>
  <body>
    <div id="screen" class="waiting">클릭해서 시작하세요</div>
    <div id="result"></div>

    <script>
      const $screen = document.querySelector("#screen");
      const $result = document.querySelector("#result");

      let state = "waiting"; // waiting | starting | checking | result | tooFast
      let startTime = null;
      let timeoutId = null;
      let records = [];

      function responseCheck() {
        if (state === "waiting") {
          startGame();
        } else if (state === "starting") {
          tooFast();
        } else if (state === "checking") {
          finishGame();
        } else if (state === "result") {
          reset();
        } else if (state === "tooFast") {
          reset();
        }
      }

      function startGame() {
        state = "starting";
        screenChange("waiting", "starting");
        $screen.textContent = "초록색이 되면 클릭하세요";

        timeoutId = setTimeout(() => {
          state = "checking";
          screenChange("starting", "checking");
          $screen.textContent = "지금 클릭!";
          startTime = new Date();
        }, randomDelay());
      }

      function tooFast() {
        clearTimeout(timeoutId);
        screenChange("starting", "tooFast");
        $screen.textContent = "너무 빨랐어요.";
        state = "tooFast";
      }

      function finishGame() {
        const endTime = new Date();
        const reactionTime = endTime - startTime;

        records.push(reactionTime);

        renderResult();
        state = "result";
        $screen.textContent = "클릭 시 첫 화면으로 돌아갑니다.";
      }

      function renderResult() {
        $result.innerHTML = records
          .map((time, idx) => `${idx + 1}회: ${(time / 1000).toFixed(3)}초`)
          .join("<br>");
        $result.innerHTML += `<br>평균 반응속도는 ${(
          records.reduce((acc, time) => acc + time / 1000, 0) / records.length
        ).toFixed(3)}초 입니다.<br>`;
      }

      function reset() {
        state = "waiting";
        startTime = null;
        timeoutId = null;
        $screen.className = "waiting";
        $screen.textContent = "클릭해서 시작하세요";
      }

      function screenChange(removeClass, addClass) {
        $screen.classList.remove(removeClass);
        $screen.classList.add(addClass);
      }

      function randomDelay() {
        return 2000 + Math.random() * 3000;
      }

      $screen.addEventListener("click", responseCheck);
    </script>
  </body>
</html>
